<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>风不二 | 会工作&amp;爱生活</title>

  
  <meta name="author" content="ibeeger">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="风不二"/>

  
  <meta property="og:image" content="/blog/favicon.ico"/>
  

  <link href="/blog/favicon.ico" rel="icon">
  <link rel="alternate" href="/blog/atom.xml" title="风不二" type="application/atom+xml">
  <link rel="stylesheet" href="/blog/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/blog/">风不二</a>
    </h1>
    <p class="site-description">会工作&amp;爱生活</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/blog/">Home</a></li>
      
        <li><a href="/blog/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/blog/2017/09/08/nodejs-http/"><span>nodejs-http</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2017/09/08/nodejs-http/" rel="bookmark">
        <time class="entry-date published" datetime="2017-09-08T12:48:51.000Z">
          2017-09-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>今天遇到场景，导出年级报告（pdf），一个页面需要中间层（node）向底层请求50+数量接口提供数据，因为接口数量过多，数据请求完成还后需要生成pdf。不管怎么请求都会超时，用户端都会超时，平均一个报告至少需要1分钟<br>甚至更长。</p>
<p>技术方案：</p>
<ul>
<li>Object.defineProperty set 避免深层回调</li>
<li>res.write(progress);    </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[javascript]</span><br><span class="line"></span><br><span class="line">let allUrlList = []//所有url接口</span><br><span class="line">let allDataObject = &#123;&#125;;</span><br><span class="line">let itemUrl = Object.defineProperty(&#123;&#125;, &quot;num&quot;, &#123;</span><br><span class="line">		set:function(num)&#123;</span><br><span class="line">			fetch(allUrlList[num],&#123;...postJson&#125;,(data)=&gt;&#123;</span><br><span class="line">			res.write(parseInt(num/allUrlList.length));</span><br><span class="line">			allDataObject.merge(data);</span><br><span class="line">			itemUrl.num = num+1;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="http://iassets.oss-cn-beijing.aliyuncs.com/images/result.png" alt="图片"></p>
<font color="#ff0000">疑问：也希望各位大神能帮忙解惑，同样的等待时间，为什么不断的，res.write(progress)就不会超时了？</font>


<p>另外产生一个问题：因为等待时间比较长，用户会主动关闭页面或者返回等终端请求，服务端的接口依然是在请求，对一些资源有不必要的浪费.<br>因此又有了新的方案，如下代码<br>原理是侦听close事件，这里要注意不是abort; </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[javascript]</span><br><span class="line">const http = require(&quot;http&quot;);</span><br><span class="line">const server = http.createServer(function(req,res)&#123;</span><br><span class="line">		res.writeHead(200,&#123;&apos;Content-type&apos;:&apos;text/html&apos;&#125;)</span><br><span class="line">	    if (req.url==&apos;\/favicon.ico&apos;) &#123;</span><br><span class="line">	    	res.end();</span><br><span class="line">	    	return;</span><br><span class="line">	    &#125;</span><br><span class="line">	    if(req.url==&apos;/test&apos;)&#123;</span><br><span class="line">	    	setTimeout(function()&#123;</span><br><span class="line">	    		res.write(&quot;test&quot;);</span><br><span class="line">	    		res.end()</span><br><span class="line">	    	&#125;,15000)</span><br><span class="line">	    &#125;;</span><br><span class="line">	    let i = 0;</span><br><span class="line">		let t = setInterval(function()&#123;</span><br><span class="line">			res.write(&quot;hello&quot;);</span><br><span class="line">			console.log(i);</span><br><span class="line">			if (i==10) &#123;</span><br><span class="line">				res.end();</span><br><span class="line">				clearInterval(t);</span><br><span class="line">			&#125;;</span><br><span class="line">			i++</span><br><span class="line">		&#125;,1000);</span><br><span class="line">		res.on(&apos;finish&apos;, function () &#123;</span><br><span class="line">	        console.log(&apos;server: response finish&apos;);</span><br><span class="line">	    &#125;);</span><br><span class="line">		res.on(&apos;close&apos;, function () &#123;</span><br><span class="line">       		 console.log(&apos;server: response close&apos;);</span><br><span class="line">       		 clearInterval(t);</span><br><span class="line">   		 &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server.listen(8032);</span><br><span class="line">server.on(&apos;listening&apos;,function()&#123;</span><br><span class="line">    console.log(&apos;ok, server is running&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/nodejs-http/">nodejs http</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2017/05/25/node-redis/"><span>nodejs链接redis实践</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2017/05/25/node-redis/" rel="bookmark">
        <time class="entry-date published" datetime="2017-05-25T03:18:39.000Z">
          2017-05-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>为了减轻服务底层一些压力以及业务需要，我们前端开始直接介入redis数据查询，为此又要开始充电了，距离实施还有一段时间,还是需要系统的研究下。下文如有什么错误希望各位老师帮忙指出。</p>
<p>准备工作，这里使用的是 <a href="https://www.npmjs.com/package/redis" target="_blank" rel="noopener">https://www.npmjs.com/package/redis</a></p>
<p>网络原因 尝试了多次安装最后还是用淘宝的镜像站安装成功了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save redis</span><br></pre></td></tr></table></figure>
<p>开始实践前要对 redis 有大概的了解，我就简单的说下我的拙见，<br>redis 也就是kv方式的储存数据，给我的感觉就是 临时、高效。当然这是我当做门外汉的理解。具体深入还是需要看专业的文章。</p>
<p>它有String、Hash、List、Set、Zset 五中数据格式 分别对应不同的方法</p>
<p>具体下面都会讲到<br>首先还是正确的链接redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[javascript]</span><br><span class="line">const redis = require(&quot;redis&quot;);</span><br><span class="line">const client = redis.createClient(&apos;6381&apos;, &apos;172.16.10.40&apos;); 端口号和ip地址</span><br><span class="line">client.auth(&quot;xxxxxxx&quot;);//认证 是一串字符，并不是key value的方式</span><br><span class="line">client.select(&quot;18&quot;,callback);// 18 redis 默认有18个数据库（可能跟设置，版本有关系数量不同，如下图所示） 选择一个数据库</span><br></pre></td></tr></table></figure>
<p> <img src="http://iassets.oss-cn-beijing.aliyuncs.com/images/20171209240.png" alt="18个数据库"></p>
<p>###String </p>
<p> 方法：</p>
<ul>
<li>client.set(key:string,value:string,[,EX,time(s)],redis.print);</li>
<li><p>client.get(key:string,callback);<br>如下代码所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">client.set(&quot;test&quot;,&quot;hello redis&quot;,redis.print);//设置</span><br><span class="line">client.set(&quot;test&quot;,&quot;hello redis&quot;,&quot;EX&quot;,10,redis.print);//设置过期时间 10s</span><br><span class="line">client.get(&quot;test&quot;,(err,result)=&gt;&#123;&#125;)// result:hello word;</span><br><span class="line">client.del(&quot;test&quot;,()=&gt;&#123;console.log(arguments)&#125;)//删除</span><br></pre></td></tr></table></figure>
<p>如下图<br><img src="http://iassets.oss-cn-beijing.aliyuncs.com/images/20171209335.png" alt="插入"></p>
</li>
</ul>
<p>###Hash<br> 方法：</p>
<ul>
<li>client.hset(hashName:string, key, value, redis.print); 注意该方法可以多次向同一个hashName设置多个值</li>
<li>client.hgetall(hashName:string,callback);</li>
</ul>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">client.hset(&quot;testhash&quot;,&quot;key1&quot;,&quot;value1&quot;,redis.print);</span><br><span class="line">client.hset(&quot;testhash&quot;,&quot;key2&quot;,&quot;value2&quot;,redis.print);</span><br><span class="line">client.hgetall(&quot;testhash&quot;,callback)// &#123;&apos;key1&apos;:&apos;value1&apos;,&apos;key2&apos;:&apos;value2&apos;&#125;</span><br></pre></td></tr></table></figure>
<p>如下图<br><img src="http://iassets.oss-cn-beijing.aliyuncs.com/images/20171209338.png" alt="插入"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/node-redis/">node redis</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2015/10/13/tessract-orc/"><span>识别图片文字</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2015/10/13/tessract-orc/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-13T14:47:58.000Z">
          2015-10-13
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>安装</p>
<blockquote>
<p>brew install tesseract        </p>
</blockquote>
<p>源代码安装</p>
<blockquote>
<p>git clone <a href="https://github.com/tesseract-ocr/tesseract.git" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract.git</a><br>./autogen.sh<br>./configure<br>make<br>make install<br>sudo ldconfig</p>
</blockquote>
<p>安装语言包</p>
<blockquote>
<p>brew install tesseract –all-languages    </p>
</blockquote>
<p>使用</p>
<blockquote>
<p>tesseract article.png  text -l chi_sim </p>
</blockquote>
<ul>
<li>article.png 提取文字的图片        </li>
<li>text 提取后 存放的文件  后缀名 .txt;        </li>
<li>-l chi_sim  语言 中文</li>
</ul>
<p>语言</p>
<ul>
<li>afr (Afrikaans) </li>
<li>amh (Amharic) </li>
<li>ara (Arabic) </li>
<li>asm (Assamese) </li>
<li>aze (Azerbaijani) </li>
<li>aze_cyrl (Azerbaijani - Cyrilic) </li>
<li>bel (Belarusian) </li>
<li>ben (Bengali) </li>
<li>bod (Tibetan) </li>
<li>bos (Bosnian) </li>
<li>bul (Bulgarian) </li>
<li>cat (Catalan; Valencian) </li>
<li>ceb (Cebuano) </li>
<li>ces (Czech) </li>
<li>chi_sim (Chinese - Simplified) </li>
<li>chi_tra (Chinese - Traditional) </li>
<li>chr (Cherokee) </li>
<li>cym (Welsh) </li>
<li>dan (Danish) </li>
<li>dan_frak (Danish - Fraktur) </li>
<li>deu (German) </li>
<li>deu_frak (German - Fraktur) </li>
<li>dzo (Dzongkha) </li>
<li>ell (Greek, Modern (1453-)) </li>
<li>eng (English) </li>
<li>enm (English, Middle (1100-1500)) </li>
<li>epo (Esperanto) </li>
<li>equ (Math / equation detection module) </li>
<li>est (Estonian) </li>
<li>eus (Basque) </li>
<li>fas (Persian) </li>
<li>fin (Finnish) </li>
<li>fra (French) </li>
<li>frk (Frankish) </li>
<li>frm (French, Middle (ca.1400-1600)) </li>
<li>gle (Irish) </li>
<li>glg (Galician) </li>
<li>grc (Greek, Ancient (to 1453)) </li>
<li>guj (Gujarati) </li>
<li>hat (Haitian; Haitian Creole) </li>
<li>heb (Hebrew) </li>
<li>hin (Hindi) </li>
<li>hrv (Croatian) </li>
<li>hun (Hungarian) </li>
<li>iku (Inuktitut) </li>
<li>ind (Indonesian) </li>
<li>isl (Icelandic) </li>
<li>ita (Italian) </li>
<li>ita_old (Italian - Old) </li>
<li>jav (Javanese) </li>
<li>jpn (Japanese) </li>
<li>kan (Kannada) </li>
<li>kat (Georgian) </li>
<li>kat_old (Georgian - Old) </li>
<li>kaz (Kazakh) </li>
<li>khm (Central Khmer) </li>
<li>kir (Kirghiz; Kyrgyz) </li>
<li>kor (Korean) </li>
<li>kur (Kurdish) </li>
<li>lao (Lao) </li>
<li>lat (Latin) </li>
<li>lav (Latvian) </li>
<li>lit (Lithuanian) </li>
<li>mal (Malayalam) </li>
<li>mar (Marathi) </li>
<li>mkd (Macedonian) </li>
<li>mlt (Maltese) </li>
<li>msa (Malay) </li>
<li>mya (Burmese) </li>
<li>nep (Nepali) </li>
<li>nld (Dutch; Flemish) </li>
<li>nor (Norwegian) </li>
<li>ori (Oriya) </li>
<li>osd (Orientation and script detection module) </li>
<li>pan (Panjabi; Punjabi) </li>
<li>pol (Polish) </li>
<li>por (Portuguese) </li>
<li>pus (Pushto; Pashto) </li>
<li>ron (Romanian; Moldavian; Moldovan) </li>
<li>rus (Russian) </li>
<li>san (Sanskrit) </li>
<li>sin (Sinhala; Sinhalese) </li>
<li>slk (Slovak) </li>
<li>slk_frak (Slovak - Fraktur) </li>
<li>slv (Slovenian) </li>
<li>spa (Spanish; Castilian) </li>
<li>spa_old (Spanish; Castilian - Old) </li>
<li>sqi (Albanian) </li>
<li>srp (Serbian) </li>
<li>srp_latn (Serbian - Latin) </li>
<li>swa (Swahili) </li>
<li>swe (Swedish) </li>
<li>syr (Syriac) </li>
<li>tam (Tamil) </li>
<li>tel (Telugu) </li>
<li>tgk (Tajik) </li>
<li>tgl (Tagalog) </li>
<li>tha (Thai) </li>
<li>tir (Tigrinya) </li>
<li>tur (Turkish) </li>
<li>uig (Uighur; Uyghur) </li>
<li>ukr (Ukrainian) </li>
<li>urd (Urdu) </li>
<li>uzb (Uzbek) </li>
<li>uzb_cyrl (Uzbek - Cyrilic) </li>
<li>vie (Vietnamese) </li>
<li>yid (Yiddish)</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2015/09/08/imagemagick/"><span>ImageMagick教程</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2015/09/08/imagemagick/" rel="bookmark">
        <time class="entry-date published" datetime="2015-09-08T03:59:03.000Z">
          2015-09-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>####拼图</p>
<blockquote>
<p>montage ./*.png -tile 50x20 -geometry 32x32  icons.png</p>
</blockquote>
<p>-tile x轴50个  y轴 20个<br>-geometry 32x32 长宽 各32        </p>
<p>ImageMagick操作之图片高级操作</p>
<p>1、图片指定区域变色<br>指定区域尺寸和起始坐标（50x60+20+10）、区域颜色（rgb(255,0,0)）、着色程度（20%）。</p>
<blockquote>
<p>convert old.png -region 50x60+20+10 -fill “rgb(255,0,0)” -colorize 20% new.png<br>convert 2.jpg -region 150x100+20+10 -fill “rgb(255,0,0)” -colorize 20% new.png</p>
</blockquote>
<p>2、图片指定区域变色（放大或缩小区域）<br>指定区域尺寸和起始坐标（50x60+20+10）、尺寸（120%）、区域颜色（rgb(255,0,0)）、着色程度（20%）。</p>
<blockquote>
<p>convert old.png -region 50x60+20+10 -resize 120% -fill “rgb(255,0,0)” -colorize 20% new.png</p>
</blockquote>
<p>3、替换相同颜色的区域（指定颜色）<br>指定颜色差异程度（10%），替换颜色（黑色），被替换颜色（白色）。将整张图片中的指定颜色全部替换。</p>
<blockquote>
<p>convert 2.jpg -alpha set -channel RGBA -fuzz 10% -fill “rgb(0,0,0)” -opaque “rgb(255,255,255)” new.png</p>
</blockquote>
<p>4、替换不同颜色的区域（指定颜色）<br>指定颜色差异程度（50%），替换颜色（白色），指定颜色（蓝色）。将整张图片中除指定颜色外的颜色全部替换。</p>
<blockquote>
<p>convert 2.jpg -alpha set -channel RGBA -fuzz 50% -fill “rgb(255,255,255)” +opaque “rgb(0,0,255)” new.png</p>
</blockquote>
<p>5、替换相同颜色的区域（指定坐标）<br>指定颜色差异程度（10%），替换颜色（红色），指定坐标（180,150）。将整张图片中与指定位置颜色相同的颜色全部替换。</p>
<blockquote>
<p>convert 2.jpg -alpha set -channel RGBA -fuzz 10% -fill “rgb(255,0,0)” -draw “color 180,150 replace” new.png</p>
</blockquote>
<p>6、替换相同颜色的连通区域（指定坐标）<br>指定颜色差异程度（10%），替换颜色（红色），指定坐标（180,150）。将图片连通区域中与指定位置颜色相同的颜色全部替换。</p>
<blockquote>
<p>convert 2.jpg -alpha set -channel RGBA -fuzz 10% -fill “rgb(255,0,0)” -draw “color 180,150 replace” new.png</p>
</blockquote>
<p>7、图像边缘突出显示<br>指定探测半径（5），对图像中类似边缘的像素进行探测。使边缘突显出来，易于观察。</p>
<blockquote>
<p>convert old.png -edge 5 new.png</p>
</blockquote>
<p>8、图像边缘探测<br>指定探测半径（5）。</p>
<blockquote>
<p>convert 2.jpg -background white -flatten -colorspace gray -negate -edge 5 -negate -normalize -threshold 50% -despeckle -blur 0x.5 -contrast-stretch 0x50% new.png</p>
</blockquote>
<p>##合并图片</p>
<blockquote>
<p>composite -gravity north src.jpg coverback.jpg des.jpg</p>
</blockquote>
<p>其中src.jpg为前景图片</p>
<p>coverback.jpg为背景图片。</p>
<p>des.jpg为叠加后的结果</p>
<p>##生成 ico</p>
<blockquote>
<p>convert logo.png -background none favicon.ico</p>
</blockquote>
<p>##获取图片信息</p>
<blockquote>
<p>identify image.png<br>identify -format “%wx%h” image.png  //只获取宽高</p>
</blockquote>
<p>##放大缩小</p>
<blockquote>
<p>convert image.png -resize 200x200 resize.png<br>convert image.png -resize 50% resize.png<br>convert image.png -sample 50% sample.png   //用来生成缩略图最合适<br>convert image.png -sample 10% -sample 1000% sample.png //处理马赛克</p>
</blockquote>
<p>##裁剪 -crop</p>
<blockquote>
<p>convert image.png -crop 100x100+50+50 crop.png //从（50，50）位置开始，裁剪一个100X100大小的图片：<br>convert image.png -crop 100x100 crop.png<br>convert image.png -gravity northeast -crop 100x100+0+0 crop.png </p>
</blockquote>
<ul>
<li>-gravity即指定坐标原点，    </li>
<li>northwest：左上角，    </li>
<li>north：上边中间，        </li>
<li>northeast：右上角，    </li>
<li>east：右边中间    </li>
</ul>
<p>##旋转 -rotate</p>
<blockquote>
<p>convert image.png -rotate 45 rotate.png  </p>
</blockquote>
<p>##合并</p>
<blockquote>
<p>convert image.png -compose over overlay.png -composite newimage.png</p>
</blockquote>
<p>##更改图片的alpha通道</p>
<blockquote>
<p>convert image.png -define png:format=png32  image32.png<br>convert image32.png -channel alpha -fx “0.5” imagealpha.png  </p>
</blockquote>
<p>##拼接</p>
<blockquote>
<p>convert image1.png image2.png image3.png -gravity south +append result.png </p>
</blockquote>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/ImageMagick/">ImageMagick</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2015/05/15/wxpay/"><span>微信支付注意事项</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2015/05/15/wxpay/" rel="bookmark">
        <time class="entry-date published" datetime="2015-05-15T13:50:21.000Z">
          2015-05-15
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>####准备工作 </p>
<ul>
<li>appid 公众号id</li>
<li>mch_id 商户号 公众号申请微信支付成功后 会有个商户号</li>
<li>key 密钥 申请成功后会收到邮件 会带着密钥 用于签名</li>
</ul>
<p>####配置环境：</p>
<ul>
<li>配置支付目录（开发，生产环境）</li>
<li>配置支付成功回调地址</li>
</ul>
<p>####开发</p>
<ul>
<li>获取prepay_id 首先根据统一下单接口获取<br>注意：<br>1、区分大小写<br>2、排序    </li>
</ul>
<blockquote>
<p>let item = {}<br>   Object.keys(json).sort().map(function(key) {<br>       item[key] = json[key];<br>   });</p>
</blockquote>
<p>3、拼接 (记得加上 key) 放在最后就行</p>
<blockquote>
<p>querystring.stringify(json) </p>
</blockquote>
<p>4、签名 md5 记得转换大写</p>
<blockquote>
<p>let t = crypto.createHash(“md5”);<br>t.update(url, “utf8”, “hex”);<br>t.digest(“hex”).toUpperCase();</p>
</blockquote>
<p>5、增加sign字段<br>6、请求的时候 记得转换xml </p>
<ul>
<li>h5发起支付<br> 签名注意<br> 1、时间戳记得转换成字符串  ios会提示有问题<br> 2、记得加上key</li>
</ul>
<p>未完待续~~~~</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2014/05/11/mongodb/"><span>mongodb</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2014/05/11/mongodb/" rel="bookmark">
        <time class="entry-date published" datetime="2014-05-11T14:25:59.000Z">
          2014-05-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>###条件查询 $lt, $gt, $lte, $gte, $ne;</p>
<p>&lt;, &lt;=, &gt;, &gt;=  !=这个操作符就不用多解释了，最常用也是最简单的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123; &quot;field&quot; : &#123; $gt: value &#125; &#125; ); // 大于: field &gt; value</span><br><span class="line">db.collection.find(&#123; &quot;field&quot; : &#123; $lt: value &#125; &#125; ); // 小于: field &lt; value</span><br><span class="line">db.collection.find(&#123; &quot;field&quot; : &#123; $gte: value &#125; &#125; ); // 大于等于: field &gt;= value</span><br><span class="line">db.collection.find(&#123; &quot;field&quot; : &#123; $lte: value &#125; &#125; ); // 小于等于: field &lt;= value</span><br></pre></td></tr></table></figure>
<p>如果要同时满足多个条件，可以这样做</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&#123; &quot;field&quot; : &#123; $gt: value1, $lt: value2 &#125; &#125; ); // value1 &lt; field &lt; value2</span><br></pre></td></tr></table></figure>
<p>注意：以后练习中请先创建数据，进行下面查询练习。</p>
<p>首先我们先创建几条数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.insert([&#123;name:&quot;Tom&quot;,age:20,sex:&quot;m&quot;&#125;,&#123;name:&quot;Lily&quot;,age:40,sex:&quot;f&quot;&#125;,&#123;name:&quot;Suby&quot;,age:18&#125;]);</span><br></pre></td></tr></table></figure></p>
<p>请查询age大于19并且小于45的记录。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123; age : &#123; $gt: 19, $lt: 45&#125; &#125;);</span><br></pre></td></tr></table></figure></p>
<p>查询x 的值不等于3 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.things.find( &#123; x : &#123; $ne : 3 &#125; &#125; );</span><br></pre></td></tr></table></figure>
<p>举例如下:</p>
<p>C1 表的数据如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af85afa87dc1bed94330&quot;), &quot;age&quot; : 7, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af89afa87dc1bed94331&quot;), &quot;age&quot; : 8, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af8cafa87dc1bed94332&quot;), &quot;age&quot; : 6, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>查询age 的值不等于7 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find( &#123; age : &#123; $ne : 7 &#125; &#125; );</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af89afa87dc1bed94331&quot;), &quot;age&quot; : 8, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af8cafa87dc1bed94332&quot;), &quot;age&quot; : 6, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出只显示出了age 不等于7 的数据，其它不符合规则的数据并没有显示出来</p>
<p>在users文档中查询”age”不等于20的记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age:&#123;$ne:20&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="in-nin-all包含查询"><a href="#in-nin-all包含查询" class="headerlink" title="$in, $nin ,$all包含查询"></a>$in, $nin ,$all包含查询</h3><ul>
<li>$in</li>
</ul>
<p>与sql 标准语法的用途是一样的，即要查询的是一系列枚举值的范围内</p>
<p>查询x 的值在2,4,6 范围内的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.things.find(&#123;x:&#123;$in: [2,4,6]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>举例如下:</p>
<p>C1 表的数据如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af85afa87dc1bed94330&quot;), &quot;age&quot; : 7, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af89afa87dc1bed94331&quot;), &quot;age&quot; : 8, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af8cafa87dc1bed94332&quot;), &quot;age&quot; : 6, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>查询age 的值在7,8 范围内的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find(&#123;age:&#123;$in: [7,8]&#125;&#125;);</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af85afa87dc1bed94330&quot;), &quot;age&quot; : 7, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af89afa87dc1bed94331&quot;), &quot;age&quot; : 8, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出只显示出了age 等于7 或8 的数据，其它不符合规则的数据并没有显示出来</p>
<p>“$in”非常灵活，可以指定不同类型的条件和值。</p>
<p>在users文档查询”age”等于11或26的记录。<br>db.users.find({age:{$in:[11,26]}});</p>
<ul>
<li>$nin </li>
</ul>
<p>与sql 标准语法的用途是一样的，即要查询的数据在一系列枚举值的范围外</p>
<p>查询x 的值在2,4,6 范围外的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.things.find(&#123;x:&#123;$nin: [2,4,6]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p>举例如下:</p>
<p>C1 表的数据如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> db.c1.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af85afa87dc1bed94330&quot;), &quot;age&quot; : 7, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af89afa87dc1bed94331&quot;), &quot;age&quot; : 8, &quot;length_1&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af8cafa87dc1bed94332&quot;), &quot;age&quot; : 6, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>查询age 的值在7,8 范围外的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find(&#123;age:&#123;$nin: [7,8]&#125;&#125;);</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af8cafa87dc1bed94332&quot;), &quot;age&quot; : 6, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出只显示出了age 不等于7 或8 的数据，其它不符合规则的数据并没有显示出来</p>
<p>在users文档中查询”age”不等于18或者20的记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age:&#123;$nin:[18,20]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>$all</li>
</ul>
<p>这个操作符跟SQL 语法的in 类似，但不同的是, in 只需满足( )内的某一个值即可, 而$all 必须满足[ ]内的所有值，例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age : &#123;$all : [6, 8]&#125;&#125;);</span><br><span class="line">可以查询出 &#123;name: &apos;David&apos;, age: 26, age: [ 6, 8, 9 ] &#125;</span><br><span class="line">但查询不出 &#123;name: &apos;David&apos;, age: 26, age: [ 6, 7, 9 ] &#125;</span><br></pre></td></tr></table></figure>
<p>首先先创建含有数组的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.insert(&#123;&quot;name&quot;:&quot;David&quot;,age:26,course:[&quot;js&quot;,&quot;Node&quot;,&quot;Mongodb&quot;]&#125;,&#123;&quot;name&quot;:&quot;Tom&quot;,age:26,course:[&quot;js&quot;,&quot;Node&quot;,&quot;Mongoose&quot;]&#125;)</span><br></pre></td></tr></table></figure>
<p>在users文档中课程既有”js”,又有”Mongodb”的文档。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;course:&#123;$all:[&quot;js&quot;,&quot;Mongodb&quot;]&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="exists判断字段是否存在"><a href="#exists判断字段是否存在" class="headerlink" title="$exists判断字段是否存在"></a>$exists判断字段是否存在</h3><p>查询所有存在age 字段的记录</p>
<p>db.users.find({age: {$exists: true}});</p>
<p>查询所有不存在name 字段的记录</p>
<p>db.users.find({name: {$exists: false}});</p>
<p>举例如下:</p>
<p>C1 表的数据如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4a773afa87dc1bed9432d&quot;), &quot;age&quot; : 20, &quot;length&quot; : 30 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4a7e1afa87dc1bed9432e&quot;), &quot;age_1&quot; : 20, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>查询存在字段age 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.c1.find(&#123;age:&#123;$exists:true&#125;&#125;);</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4a773afa87dc1bed9432d&quot;), &quot;age&quot; : 20, &quot;length&quot; : 30 &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出只显示出了有age 字段的数据，age_1 的数据并没有显示出来</p>
<p>在users文档中”sex”字段存在的记录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;sex: &#123;$exists: true&#125;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Null值处理"><a href="#Null值处理" class="headerlink" title="Null值处理"></a>Null值处理</h3><p>Null 值的处理稍微有一点奇怪，具体看下面的样例数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fc34bb81d8a39f01cc17ef4&quot;), &quot;name&quot; : &quot;Lily&quot;, &quot;age&quot; : null &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fc34be01d8a39f01cc17ef5&quot;), &quot;name&quot; : &quot;Jacky&quot;, &quot;age&quot; : 23 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fc34c1e1d8a39f01cc17ef6&quot;), &quot;name&quot; : &quot;Tom&quot;, &quot;addr&quot; : 23 &#125;</span><br></pre></td></tr></table></figure>
<p>其中”Lily”的age 字段为空，Tom 没有age 字段，我们想找到age 为空的行，具体如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.c2.find(&#123;age:null&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fc34bb81d8a39f01cc17ef4&quot;), &quot;name&quot; : &quot;Lily&quot;, &quot;age&quot; : null &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fc34c1e1d8a39f01cc17ef6&quot;), &quot;name&quot; : &quot;Tom&quot;, &quot;addr&quot; : 23 &#125;</span><br></pre></td></tr></table></figure>
<p>奇怪的是我们以为只能找到”Lily”，但”Tom”也被找出来了，因为”null”不仅会匹配某个键的值为null的文档，而且还会匹配不包含这个键的文档 。那么怎么样才能只找到”Lily”呢?我们用exists 来限制一下即可.</p>
<p>在users文档找出”sex”值为”null”并且字段存在的记录。</p>
<figure class="highlight plain"><figcaption><span>"$exists":true&#125;&#125;);```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### $mod取模运算</span><br><span class="line">查询age 取模10 等于0 的数据</span><br></pre></td></tr></table></figure>
<p>db.student.find( { age: { $mod : [ 10 , 1 ] } } )<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">举例如下:</span><br><span class="line"></span><br><span class="line">C1 表的数据如下:</span><br></pre></td></tr></table></figure></p>
<p>db.c1.find()<br>{ “_id” : ObjectId(“4fb4af85afa87dc1bed94330”), “age” : 7, “length_1” : 30 }<br>{ “_id” : ObjectId(“4fb4af89afa87dc1bed94331”), “age” : 8, “length_1” : 30 }<br>{ “_id” : ObjectId(“4fb4af8cafa87dc1bed94332”), “age” : 6, “length_1” : 30 }<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">查询age 取模6 等于1 的数据</span><br><span class="line"></span><br><span class="line">```db.c1.find(&#123;age: &#123;$mod : [ 6 , 1 ] &#125; &#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;4fb4af85afa87dc1bed94330&quot;), &quot;age&quot; : 7, &quot;length_1&quot; : 30 &#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出只显示出了age 取模6 等于1 的数据，其它不符合规则的数据并没有显示出来</p>
<p>在users文档中查询”age”取模5 等于1的数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age:&#123;$mod:[5,1]&#125;&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="size数组元素个数"><a href="#size数组元素个数" class="headerlink" title="$size数组元素个数"></a>$size数组元素个数</h3><p>对于{name: ‘David’, age: 26, favorite_number: [ 6, 7, 9 ] }记录</p>
<p>匹配db.users.find({favorite_number: {$size: 3}});</p>
<p>不匹配db.users.find({favorite_number: {$size: 2}});</p>
<p>“$size”对于查询数组来说也是非常有用的，顾名思义，可以用它查询特定长度的数组。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;favorite_number: &#123;$size: 3&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>得到一个长度范围内的文档是一种常见的查询。”$size”并不能与其他查询条件（比如”$gt”）组合使用，但是这种查询可以通过在文档中添加一个”size”键的方式来实现。这样每一次向指定数组添加元素时，同时增加”size”的值。比如，原来这样的更新：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(criteria,&#123;&quot;$push&quot;:&#123;&quot;favorite_number&quot;:&quot;1&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure></p>
<p>就要变成下面这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.update(criteria, &#123;&quot;$push&quot;:&#123;&quot;favorite_number&quot;:&quot;1&quot;&#125;,&quot;$inc&quot;:&#123;&quot;$size&quot;:1&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>自增操作的速度非常快，所以对性能的影响微乎其微。这样存储文档后，就可以像下面这样查询了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;&quot;$size&quot;:&#123;&quot;$gt&quot;:3&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>很遗憾，这种技巧并不能与”$addToSet”操作符同时使用。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/mongodb/">mongodb</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2013/06/12/msgpack/"><span>msgpack 实践</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2013/06/12/msgpack/" rel="bookmark">
        <time class="entry-date published" datetime="2013-06-12T14:04:43.000Z">
          2013-06-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>没听过的朋友可以自行先谷歌、百度下， </p>
<p><a href="https://msgpack.org" target="_blank" rel="noopener">https://msgpack.org</a></p>
<p><img src="http://iassets.oss-cn-beijing.aliyuncs.com/images/20171212.png" alt="msgpack"></p>
<p>其实这个场景在web上可能用到的不会太多，app的接口场景会比较实际些，具体情况具体分析，<br>总之，这个msgpack相比json能减少体积。</p>
<p>好了言归正传</p>
<p>下面的例子基于 </p>
<ul>
<li>服务端 msgpack5 : <a href="https://www.npmjs.com/package/msgpack5" target="_blank" rel="noopener">https://www.npmjs.com/package/msgpack5</a></li>
<li>客户端  <a href="https://github.com/msgpack" target="_blank" rel="noopener">https://github.com/msgpack</a></li>
</ul>
<p>服务端代码：</p>
<blockquote>
<p> var msgpack = require(“msgpack5”)();<br>//设置类型<br> res.set(“Content-Type”, “application/msgpack”);<br>//数据格式化<br>var _data = msgpack.encode({<br>     a:1,<br>     b:2,<br>     c:3<br>});<br>res.send(_data);</p>
</blockquote>
<p>客户端代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var oReq = new XMLHttpRequest();	</span><br><span class="line">    oReq.open(&quot;POST&quot;, &quot;http://localhost:9090&quot;, true);    </span><br><span class="line">    oReq.responseType = &quot;arraybuffer&quot;;    </span><br><span class="line">var msg = msgpack5();    </span><br><span class="line">    oReq.onload = function (oEvent) &#123;    </span><br><span class="line">var arrayBuffer = oReq.response;     </span><br><span class="line">	if (arrayBuffer) &#123;    </span><br><span class="line">		var byteArray = new Uint8Array(arrayBuffer);    </span><br><span class="line">		var s  = msg.decode(byteArray);    </span><br><span class="line"> 		   	console.log(s);    </span><br><span class="line"> 		&#125;    </span><br><span class="line"> 	&#125;;   </span><br><span class="line">var data =  a.encode([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;e&quot;]);   </span><br><span class="line">	oReq.send(data);</span><br></pre></td></tr></table></figure>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/msgpack/">msgpack</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/blog/2012/05/14/regular/"><span>正则表达式常用查询</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/blog/2012/05/14/regular/" rel="bookmark">
        <time class="entry-date published" datetime="2012-05-14T13:38:25.000Z">
          2012-05-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>###元字符</p>
<ul>
<li>.*表示任意数量的不包含换行的字符</li>
<li>. 匹配除换行符以外的任意字符</li>
<li>\w    匹配字母或数字或下划线或汉字 (不包含标点符号等特殊符号)</li>
<li>\s    匹配任意的空白符</li>
<li>\d    匹配数字</li>
<li>\b    匹配单词的开始或结束  和 ^有些类似</li>
<li>^ $ 匹配开始和结束</li>
<li>(|)或</li>
</ul>
<p>###重复</p>
<ul>
<li>*重复零次或更多次</li>
<li><ul>
<li>重复一次或更多次</li>
</ul>
</li>
<li>?    重复零次或一次</li>
<li>{n}    重复n次</li>
<li>{n,}    重复n次或更多次</li>
<li>{n,m}    重复n到m次</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/blog/tags/正则/">正则</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2017 ibeeger
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>